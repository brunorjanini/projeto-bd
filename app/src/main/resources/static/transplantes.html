<!DOCTYPE html>
<html class="light" lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sistema de Gestão de Transplantes</title>

  <!-- Fonts & Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
    rel="stylesheet"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
    rel="stylesheet"
  />

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <script id="tailwind-config">
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            primary: {
              DEFAULT: "#2b8cee",
              50: "#eaf4ff",
              100: "#d6eaff",
              200: "#b3d6ff",
              300: "#8ac1ff",
              400: "#5ca8ff",
              500: "#2b8cee",
              600: "#1976d2",
              700: "#135ea9",
              800: "#0d477f",
              900: "#072f56",
            },
            "background-light": "#f6f7f8",
            "background-dark": "#101922",
            "card-light": "#ffffff",
            "card-dark": "#182431",
            "border-light": "#e5e7eb",
            "border-dark": "#2d3748",
          },
          fontFamily: {
            display: ["Inter", "sans-serif"],
          },
          borderRadius: {
            DEFAULT: "0.5rem",
            lg: "0.75rem",
            xl: "1rem",
            full: "9999px",
          },
        },
      },
    };
  </script>

  <style>
    .material-symbols-outlined {
      font-variation-settings: "FILL" 0, "wght" 400, "GRAD" 0, "opsz" 24;
    }
    .material-symbols-outlined.fill {
      font-variation-settings: "FILL" 1;
    }
  </style>
</head>

<body
  class="bg-background-light dark:bg-background-dark font-display text-gray-800 dark:text-gray-200"
>
  <div class="flex min-h-screen w-full">
    <!-- SIDEBAR -->
    <aside
      class="sticky top-0 h-screen w-64 flex-shrink-0 border-r border-border-light dark:border-border-dark bg-card-light dark:bg-card-dark flex flex-col"
    >
      <div
        class="flex h-16 items-center gap-3 border-b border-border-light dark:border-border-dark px-6"
      >
        <div class="size-8 text-primary">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 48 48"
          >
            <path
              fill="currentColor"
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M24 4H6V17.3333V30.6667H24V44H42V30.6667V17.3333H24V4Z"
            />
          </svg>
        </div>
        <h1 class="text-lg font-bold text-gray-900 dark:text-white">SGT</h1>
      </div>
      <nav class="flex-1 space-y-2 p-4 text-sm">
        <a
          href="#sec-dashboard"
          class="flex items-center gap-3 rounded-lg bg-primary-50 px-3 py-2 text-primary dark:bg-primary-900/40 dark:text-primary-300"
        >
          <span class="material-symbols-outlined text-xl">dashboard</span>
          <span class="font-semibold">Dashboard</span>
        </a>
        <a
          href="#sec-fila"
          class="flex items-center gap-3 rounded-lg px-3 py-2 text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-800"
        >
          <span class="material-symbols-outlined text-xl"
            >person_search</span
          >
          <span class="font-medium">Pacientes</span>
        </a>
        <a
          href="#sec-reg-orgao"
          class="flex items-center gap-3 rounded-lg px-3 py-2 text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-800"
        >
          <span class="material-symbols-outlined text-xl"
            >medical_services</span
          >
          <span class="font-medium">Doadores</span>
        </a>
        <a
          href="#sec-hospitais"
          class="flex items-center gap-3 rounded-lg px-3 py-2 text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-800"
        >
          <span class="material-symbols-outlined text-xl">local_hospital</span>
          <span class="font-medium">Hospitais</span>
        </a>
        <a
          href="#sec-transportes"
          class="flex items-center gap-3 rounded-lg px-3 py-2 text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-800"
        >
          <span class="material-symbols-outlined text-xl">local_shipping</span>
          <span class="font-medium">Transportes</span>
        </a>
        <a
          href="#sec-relatorios"
          class="flex items-center gap-3 rounded-lg px-3 py-2 text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-800"
        >
          <span class="material-symbols-outlined text-xl">analytics</span>
          <span class="font-medium">Relatórios</span>
        </a>
      </nav>
      <div class="border-t border-border-light dark:border-border-dark p-4">
        <a
          href="#sec-config"
          class="flex items-center gap-3 rounded-lg px-3 py-2 text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-800"
        >
          <span class="material-symbols-outlined text-xl">settings</span>
          <span class="font-medium">Configurações</span>
        </a>
        <button
          type="button"
          class="mt-1 flex w-full items-center gap-3 rounded-lg px-3 py-2 text-left text-gray-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-800"
        >
          <span class="material-symbols-outlined text-xl">logout</span>
          <span class="font-medium">Sair</span>
        </button>
      </div>
    </aside>

    <!-- MAIN -->
    <div class="flex flex-1 flex-col" id="sec-dashboard">
      <header
        class="sticky top-0 z-10 flex h-16 items-center justify-between border-b border-border-light dark:border-border-dark bg-card-light dark:bg-card-dark px-4 sm:px-6 md:px-8"
      >
        <div class="flex flex-col">
          <h1 class="text-xl font-bold tracking-tight text-gray-900 dark:text-white">
            Sistema de Gestão de Transplantes
          </h1>
          <p class="text-sm text-gray-500 dark:text-gray-400">
            Painel de aplicação hospitalar para gestão de transplantes.
          </p>
        </div>
        <div class="flex items-center gap-4">
          <button
            class="relative rounded-full p-2 text-gray-500 hover:bg-gray-100 hover:text-gray-700 dark:text-gray-400 dark:hover:bg-gray-800 dark:hover:text-gray-200"
          >
            <span class="material-symbols-outlined">notifications</span>
            <span class="absolute top-2 right-2 flex h-2 w-2">
              <span
                class="absolute inline-flex h-full w-full animate-ping rounded-full bg-red-400 opacity-75"
              ></span>
              <span
                class="relative inline-flex h-2 w-2 rounded-full bg-red-500"
              ></span>
            </span>
          </button>
          <div
            class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10"
            data-alt="User avatar image"
            style="
              background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuBqv4lqJluFwqRsuPNzzJXcDQQcUCvIiOJh2LKUV3tNsg6UMtV0VevDZIaPaf2Jy0hQk1mfM0wyNaD4-rw_SltIK2hscoCi6HdpE-DV2j8-S5YJjAKYE0ZbjvZ9cQxcjRPlCxgBg8wqRRhvoX4PjNY2j8KaSsvSAN4ongRPUkWdSxLPuuswsEFKoMsb_UlW0Ah7gQWR_3QUNjmUiUYbhA-XYNPuDJYx0JAmChUzcnNrmM_acwnV8pdVl2x3Xs0vQySX52XHoMkSXztF');
            "
          ></div>
        </div>
      </header>

      <main class="flex-1 p-6 md:p-8 lg:p-10 space-y-6">
        <!-- GRID PRINCIPAL -->
        <section
          id="sec-hospitais"
          class="grid grid-cols-1 gap-6 lg:grid-cols-2 xl:grid-cols-4"
        >
          <!-- SITUAÇÃO HOSPITAIS -->
          <div
            class="rounded-xl border border-border-light dark:border-border-dark bg-card-light dark:bg-card-dark p-6"
          >
            <div class="flex items-center justify-between">
              <div>
                <h3
                  class="text-base font-semibold text-gray-900 dark:text-white"
                >
                  Situação dos Hospitais
                </h3>
                <p
                  class="mt-1 text-sm text-gray-500 dark:text-gray-400"
                >
                  Capacidade e órgãos disponíveis por central.
                </p>
              </div>
              <span
                class="material-symbols-outlined text-gray-400 dark:text-gray-500"
                >apartment</span
              >
            </div>

            <!-- Filtros -->
            <div class="mt-4 flex items-center gap-2 text-xs">
              <select
                id="filtroCentral"
                class="form-select rounded-lg border-gray-300 bg-gray-50 text-gray-800 focus:border-primary focus:ring-primary dark:border-gray-700 dark:bg-gray-800 dark:text-gray-200"
              >
                <option value="SP">SP</option>
                <option value="RJ">RJ</option>
              </select>
              <select
                id="filtroStatus"
                class="form-select rounded-lg border-gray-300 bg-gray-50 text-gray-800 focus:border-primary focus:ring-primary dark:border-gray-700 dark:bg-gray-800 dark:text-gray-200"
              >
                <option value="Disponível">Disponível</option>
                <option value="Em uso">Em uso</option>
                <option value="Reservado">Reservado</option>
              </select>
              <button
                id="btnAtualizarHospitais"
                class="inline-flex items-center justify-center rounded-lg bg-primary px-3 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-primary/90"
              >
                Atualizar
              </button>
            </div>

            <p
              id="erroHospitais"
              class="mt-2 text-xs text-red-500 hidden"
            ></p>

            <ul id="listaHospitais" class="mt-4 space-y-3 text-sm">
              <!-- preenchido via JS -->
            </ul>
          </div>

          <!-- FILA DE TRANSPLANTES -->
          <div
            id="sec-fila"
            class="rounded-xl border border-border-light dark:border-border-dark bg-card-light dark:bg-card-dark p-6 lg:col-span-2"
          >
            <div class="flex items-center justify-between mb-4">
              <div>
                <h3
                  class="text-base font-semibold text-gray-900 dark:text-white"
                >
                  Fila de Transplantes
                </h3>
                <p
                  class="mt-1 text-sm text-gray-500 dark:text-gray-400"
                >
                  Receptores em fila e número de transplantes realizados.
                </p>
              </div>
              <div class="flex items-center gap-2 text-xs">
                <label
                  for="filtroMinTransplantes"
                  class="text-gray-500 dark:text-gray-400"
                  >Mín. transplantes</label
                >
                <input
                  id="filtroMinTransplantes"
                  type="number"
                  value="1"
                  min="0"
                  class="form-input w-20 rounded-lg border-gray-300 bg-gray-50 text-gray-800 focus:border-primary focus:ring-primary dark:border-gray-700 dark:bg-gray-800 dark:text-gray-200"
                />
                <button
                  id="btnAtualizarFila"
                  class="inline-flex items-center justify-center rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 px-3 py-1.5 text-xs font-medium text-gray-700 dark:text-gray-200 shadow-sm hover:bg-gray-50 dark:hover:bg-gray-700"
                >
                  Atualizar
                </button>
              </div>
            </div>

            <p
              id="erroFila"
              class="mb-2 text-xs text-red-500 hidden"
            ></p>

            <div class="overflow-x-auto">
              <table class="w-full text-sm text-left">
                <thead
                  class="text-xs text-gray-500 dark:text-gray-400 uppercase bg-gray-50 dark:bg-gray-700/50"
                >
                  <tr>
                    <th class="px-4 py-3" scope="col">Paciente</th>
                    <th class="px-4 py-3" scope="col">Tipo Sanguíneo</th>
                    <th class="px-4 py-3" scope="col">Transplantes</th>
                  </tr>
                </thead>
                <tbody id="tabelaFila">
                  <!-- preenchido via JS -->
                </tbody>
              </table>
            </div>
          </div>

          <!-- REGISTRO DE ÓRGÃO -->
          <div
            id="sec-reg-orgao"
            class="rounded-xl border border-border-light dark:border-border-dark bg-card-light dark:bg-card-dark p-6"
          >
            <div class="flex items-center justify-between">
              <div>
                <h3
                  class="text-base font-semibold text-gray-900 dark:text-white"
                >
                  Registro de Órgão
                </h3>
                <p
                  class="mt-1 text-sm text-gray-500 dark:text-gray-400"
                >
                  Cadastrar novo órgão para doação.
                </p>
              </div>
              <span
                class="material-symbols-outlined text-gray-400 dark:text-gray-500"
                >app_registration</span
              >
            </div>
            <form
              id="formRegistroOrgao"
              class="mt-4 space-y-4"
            >
              <select
                id="tipoOrgao"
                class="form-select w-full rounded-lg border-gray-300 bg-gray-50 text-gray-800 focus:border-primary focus:ring-primary dark:border-gray-700 dark:bg-gray-800 dark:text-gray-200"
                required
              >
                <option value="">Selecione o órgão</option>
                <option value="Rim">Rim</option>
                <option value="Fígado">Fígado</option>
                <option value="Coração">Coração</option>
                <option value="Pulmão">Pulmão</option>
              </select>
              <input
                id="idDoador"
                type="number"
                min="1"
                required
                class="form-input w-full rounded-lg border-gray-300 bg-gray-50 text-gray-800 placeholder:text-gray-400 focus:border-primary focus:ring-primary dark:border-gray-700 dark:bg-gray-800 dark:text-gray-200"
                placeholder="ID do Doador"
              />
              <button
                type="submit"
                class="w-full inline-flex items-center justify-center rounded-lg bg-primary px-4 py-2 text-sm font-semibold text-white shadow-sm transition-colors hover:bg-primary/90"
              >
                Registrar
              </button>
              <p
                id="msgRegistroOrgao"
                class="text-xs mt-1"
              ></p>
            </form>
          </div>
        </section>

        <!-- TRANSPORTES + AVALIAÇÕES -->
        <section
          id="sec-transportes"
          class="grid grid-cols-1 gap-6 lg:grid-cols-2"
        >
          <!-- TRANSPORTES -->
          <div
            class="rounded-xl border border-border-light dark:border-border-dark bg-card-light dark:bg-card-dark p-6"
          >
            <div class="flex items-center justify-between mb-4">
              <div>
                <h3
                  class="text-base font-semibold text-gray-900 dark:text-white"
                >
                  Rastreamento de Transportes
                </h3>
                <p
                  class="mt-1 text-sm text-gray-500 dark:text-gray-400"
                >
                  Acompanhe o transporte de órgãos em tempo real.
                </p>
              </div>
              <span
                class="material-symbols-outlined text-gray-400 dark:text-gray-500 text-3xl"
                >emergency_share</span
              >
            </div>

            <!-- filtros transportes -->
            <div class="flex flex-wrap gap-2 text-xs mb-2">
              <input
                id="filtroOrigem"
                type="text"
                placeholder="Origem contém..."
                class="form-input rounded-lg border-gray-300 bg-gray-50 text-gray-800 focus:border-primary focus:ring-primary dark:border-gray-700 dark:bg-gray-800 dark:text-gray-200"
              />
              <input
                id="filtroDestino"
                type="text"
                placeholder="Destino contém..."
                class="form-input rounded-lg border-gray-300 bg-gray-50 text-gray-800 focus:border-primary focus:ring-primary dark:border-gray-700 dark:bg-gray-800 dark:text-gray-200"
              />
              <label class="inline-flex items-center gap-1 text-gray-600 dark:text-gray-300">
                <input
                  id="chkConcluidos"
                  type="checkbox"
                  checked
                  class="rounded border-gray-300 text-primary focus:ring-primary dark:border-gray-700"
                />
                Apenas concluídos
              </label>
              <button
                id="btnAtualizarTransportes"
                class="inline-flex items-center justify-center rounded-lg bg-primary px-3 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-primary/90"
              >
                Atualizar
              </button>
            </div>

            <p
              id="erroTransportes"
              class="mb-2 text-xs text-red-500 hidden"
            ></p>

            <div class="overflow-x-auto">
              <table class="w-full text-sm text-left">
                <thead
                  class="text-xs text-gray-500 dark:text-gray-400 uppercase bg-gray-50 dark:bg-gray-700/50"
                >
                  <tr>
                    <th class="px-4 py-3" scope="col">ID Órgão</th>
                    <th class="px-4 py-3" scope="col">Origem</th>
                    <th class="px-4 py-3" scope="col">Destino</th>
                    <th class="px-4 py-3" scope="col">Centro</th>
                    <th class="px-4 py-3" scope="col">GPS</th>
                    <th class="px-4 py-3" scope="col">Tempo (h)</th>
                  </tr>
                </thead>
                <tbody id="tabelaTransportes">
                  <!-- preenchido via JS -->
                </tbody>
              </table>
            </div>
          </div>

          <!-- AVALIAÇÕES / DIVISÃO -->
          <div
            id="sec-relatorios"
            class="rounded-xl border border-border-light dark:border-border-dark bg-card-light dark:bg-card-dark p-6"
          >
            <div class="flex items-center justify-between mb-4">
              <div>
                <h3
                  class="text-base font-semibold text-gray-900 dark:text-white"
                >
                  Avaliações Médicas
                </h3>
                <p
                  class="mt-1 text-sm text-gray-500 dark:text-gray-400"
                >
                  Médicos que avaliaram todos os tipos de órgão cadastrados.
                </p>
              </div>
              <span
                class="material-symbols-outlined text-gray-400 dark:text-gray-500 text-3xl"
                >checklist</span
              >
            </div>

            <div class="flex items-center gap-2 text-xs mb-2">
              <select
                id="filtroProfissao"
                class="form-select rounded-lg border-gray-300 bg-gray-50 text-gray-800 focus:border-primary focus:ring-primary dark:border-gray-700 dark:bg-gray-800 dark:text-gray-200"
              >
                <option value="MÉDICO">Médico</option>
                <option value="ENFERMEIRO">Enfermeiro</option>
              </select>
              <button
                id="btnAtualizarMedicos"
                class="inline-flex items-center justify-center rounded-lg bg-primary px-3 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-primary/90"
              >
                Consultar
              </button>
            </div>

            <p
              id="erroMedicos"
              class="mb-2 text-xs text-red-500 hidden"
            ></p>

            <ul id="listaMedicos" class="space-y-3 text-sm">
              <!-- preenchido via JS -->
            </ul>
          </div>
        </section>

        <section id="sec-config" class="text-xs text-gray-500">
          <!-- placeholder só para o link de Configurações -->
        </section>
      </main>
    </div>
  </div>

  <!-- INTEGRAÇÃO COM API -->
  <script>
    const API_BASE = "/api";

    function showError(id, message) {
      const el = document.getElementById(id);
      if (!el) return;
      if (message) {
        el.textContent = message;
        el.classList.remove("hidden");
      } else {
        el.textContent = "";
        el.classList.add("hidden");
      }
    }

    // --------- HOSPITAIS (Consulta 1) ----------
    async function carregarHospitais() {
      const central = document.getElementById("filtroCentral").value || "SP";
      const status = document.getElementById("filtroStatus").value || "Disponível";

      showError("erroHospitais", "");

      try {
        const res = await fetch(
          `${API_BASE}/relatorios/hospitais?central=${encodeURIComponent(
            central
          )}&status=${encodeURIComponent(status)}`
        );
        if (!res.ok) {
          throw new Error("Erro ao buscar hospitais");
        }
        const data = await res.json();

        const lista = document.getElementById("listaHospitais");
        lista.innerHTML = "";

        if (!data.length) {
          lista.innerHTML =
            '<li class="text-xs text-gray-500 dark:text-gray-400">Nenhum hospital encontrado para esse filtro.</li>';
          return;
        }

        data.forEach((h) => {
          const temOrgaos = (h.totalOrgaosDisponiveis || 0) > 0;
          const statusLabel = temOrgaos ? "Com órgãos disponíveis" : "Sem órgãos";
          const badgeClass = temOrgaos
            ? "bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300"
            : "bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200";

          lista.insertAdjacentHTML(
            "beforeend",
            `
            <li class="flex items-center justify-between">
              <div>
                <p class="text-sm text-gray-800 dark:text-gray-200">${h.nomeHospital}</p>
                <p class="text-xs text-gray-500 dark:text-gray-400">${h.cidade}</p>
              </div>
              <div class="text-right">
                <span class="block text-sm font-semibold">${h.totalOrgaosDisponiveis}</span>
                <span class="mt-1 inline-block rounded-full px-2.5 py-0.5 text-[11px] font-medium ${badgeClass}">
                  ${statusLabel}
                </span>
              </div>
            </li>
          `
          );
        });
      } catch (err) {
        console.error(err);
        showError("erroHospitais", "Falha ao carregar hospitais.");
      }
    }

    // --------- FILA (Consulta 3) ----------
    async function carregarFila() {
      const min = document.getElementById("filtroMinTransplantes").value || 1;
      showError("erroFila", "");

      try {
        const res = await fetch(
          `${API_BASE}/relatorios/receptores?minTransplantes=${encodeURIComponent(
            min
          )}`
        );
        if (!res.ok) {
          throw new Error("Erro ao buscar fila");
        }
        const data = await res.json();

        const tbody = document.getElementById("tabelaFila");
        tbody.innerHTML = "";

        if (!data.length) {
          tbody.innerHTML = `
            <tr>
              <td colspan="3" class="px-4 py-3 text-xs text-gray-500 dark:text-gray-400">
                Nenhum receptor encontrado para esse filtro.
              </td>
            </tr>
          `;
          return;
        }

        data.forEach((r) => {
          tbody.insertAdjacentHTML(
            "beforeend",
            `
            <tr class="border-b border-border-light dark:border-border-dark">
              <td class="px-4 py-3 font-medium text-gray-900 dark:text-white">${r.nomeReceptor}</td>
              <td class="px-4 py-3">${r.tipoSanguineo}</td>
              <td class="px-4 py-3 text-center">${r.totalTransplantes}</td>
            </tr>
          `
          );
        });
      } catch (err) {
        console.error(err);
        showError("erroFila", "Falha ao carregar fila de transplantes.");
      }
    }

    // --------- REGISTRO DE ÓRGÃO (POST /orgaos) ----------
    async function registrarOrgao(event) {
      event.preventDefault();
      const tipo = document.getElementById("tipoOrgao").value;
      const idDoador = document.getElementById("idDoador").value;
      const msgEl = document.getElementById("msgRegistroOrgao");

      msgEl.textContent = "";
      msgEl.classList.remove("text-red-500", "text-green-600");

      if (!tipo || !idDoador) {
        msgEl.textContent = "Preencha todos os campos.";
        msgEl.classList.add("text-red-500");
        return;
      }

      try {
        const res = await fetch(`${API_BASE}/orgaos`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            idDoador: Number(idDoador),
            tipoOrgao: tipo,
            status: "Disponível",
            dataCaptacao: new Date().toISOString(),
          }),
        });

        if (!res.ok) {
          throw new Error("Erro ao registrar órgão");
        }

        msgEl.textContent = "Órgão registrado com sucesso.";
        msgEl.classList.add("text-green-600");

        // recarrega situação dos hospitais para refletir contagem
        carregarHospitais();
      } catch (err) {
        console.error(err);
        msgEl.textContent = "Falha ao registrar órgão.";
        msgEl.classList.add("text-red-500");
      }
    }

    // --------- TRANSPORTES (Consulta 4) ----------
    async function carregarTransportes() {
      const origem = document.getElementById("filtroOrigem").value || "%Hosp%";
      const destino = document.getElementById("filtroDestino").value || "%Hosp%";
      const apenasConcluidos =
        document.getElementById("chkConcluidos").checked;

      showError("erroTransportes", "");

      try {
        const params = new URLSearchParams({
          origemLike: origem,
          destinoLike: destino,
          apenasConcluidos: String(apenasConcluidos),
        });

        const res = await fetch(
          `${API_BASE}/relatorios/transportes?${params.toString()}`
        );
        if (!res.ok) {
          throw new Error("Erro ao buscar transportes");
        }
        const data = await res.json();

        const tbody = document.getElementById("tabelaTransportes");
        tbody.innerHTML = "";

        if (!data.length) {
          tbody.innerHTML = `
            <tr>
              <td colspan="6" class="px-4 py-3 text-xs text-gray-500 dark:text-gray-400">
                Nenhum transporte encontrado.
              </td>
            </tr>
          `;
          return;
        }

        data.forEach((t) => {
          tbody.insertAdjacentHTML(
            "beforeend",
            `
            <tr class="border-b border-border-light dark:border-border-dark">
              <td class="px-4 py-3 font-mono text-xs text-gray-700 dark:text-gray-200">${t.idOrgao}</td>
              <td class="px-4 py-3">${t.hospitalOrigem}</td>
              <td class="px-4 py-3">${t.hospitalDestino}</td>
              <td class="px-4 py-3">${t.centroTransporte}</td>
              <td class="px-4 py-3">${t.serialGps}</td>
              <td class="px-4 py-3 text-center">${t.tempoTransitoHoras?.toFixed?.(2) ?? t.tempoTransitoHoras}</td>
            </tr>
          `
          );
        });
      } catch (err) {
        console.error(err);
        showError("erroTransportes", "Falha ao carregar transportes.");
      }
    }

    // --------- DIVISÃO / MÉDICOS (Consulta 5) ----------
    async function carregarMedicos() {
      const profissao = document.getElementById("filtroProfissao").value || "MÉDICO";
      showError("erroMedicos", "");

      try {
        const res = await fetch(
          `${API_BASE}/relatorios/profissionais-avaliaram-todos?profissao=${encodeURIComponent(
            profissao
          )}`
        );
        if (!res.ok) {
          throw new Error("Erro ao buscar médicos");
        }
        const data = await res.json();

        const lista = document.getElementById("listaMedicos");
        lista.innerHTML = "";

        if (!data.length) {
          lista.innerHTML =
            '<li class="text-xs text-gray-500 dark:text-gray-400">Nenhum profissional encontrado para esse filtro.</li>';
          return;
        }

        data.forEach((m) => {
          lista.insertAdjacentHTML(
            "beforeend",
            `
            <li class="flex items-center justify-between rounded-lg bg-gray-50 dark:bg-gray-800/50 p-3">
              <div>
                <p class="font-semibold text-gray-800 dark:text-gray-200">${m.nomeProfissional}</p>
                <p class="text-xs text-gray-500 dark:text-gray-400">
                  CPF: ${m.cpf} • ${m.profissao}
                </p>
              </div>
              <button
                type="button"
                class="inline-flex items-center justify-center rounded-lg border border-primary-600 bg-primary px-3 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-primary-700"
              >
                Detalhar
              </button>
            </li>
          `
          );
        });
      } catch (err) {
        console.error(err);
        showError("erroMedicos", "Falha ao carregar avaliações médicas.");
      }
    }

    // --------- EVENTOS / INICIALIZAÇÃO ----------
    document
      .getElementById("btnAtualizarHospitais")
      .addEventListener("click", carregarHospitais);
    document
      .getElementById("btnAtualizarFila")
      .addEventListener("click", carregarFila);
    document
      .getElementById("btnAtualizarTransportes")
      .addEventListener("click", carregarTransportes);
    document
      .getElementById("btnAtualizarMedicos")
      .addEventListener("click", carregarMedicos);
    document
      .getElementById("formRegistroOrgao")
      .addEventListener("submit", registrarOrgao);

    // Carrega dados iniciais ao abrir
    carregarHospitais();
    carregarFila();
    carregarTransportes();
    carregarMedicos();
  </script>
</body>
</html>
